<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Word → PDF Converter (Clean Notion UI)</title>

<!-- Google Font -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">

<!-- Mammoth -->
<script src="https://unpkg.com/mammoth/mammoth.browser.min.js"></script>

<!-- html2pdf -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.3/html2pdf.bundle.min.js"></script>

<style>
  body {
    font-family: 'Inter', sans-serif;
    background: #fbfbfb;
    margin: 0;
    padding: 32px;
    display: flex;
    justify-content: center;
  }

  .card {
    width: 100%;
    max-width: 760px;
    background: #ffffff;
    padding: 40px 48px;
    border-radius: 12px;
    border: 1px solid #e5e5e5;
  }

  h1 {
    margin: 0 0 6px 0;
    font-weight: 600;
    font-size: 26px;
  }

  p.lead {
    margin: 0 0 26px 0;
    color: #666;
    font-size: 15px;
  }

  #drop {
    padding: 40px;
    border: 1.8px dashed #c8c8c8;
    border-radius: 10px;
    background: #fafafa;
    text-align: center;
    color: #444;
    font-size: 15px;
    transition: 0.2s;
    cursor: pointer;
  }

  #drop:hover {
    background: #f5f5f5;
  }

  #drop.dragover {
    background: #efefef;
    border-color: #b5b5b5;
  }

  #convert {
    margin-top: 22px;
    width: 100%;
    padding: 14px;
    background: #000;
    color: #fff;
    border: none;
    border-radius: 8px;
    font-weight: 500;
    font-size: 15px;
    cursor: pointer;
    transition: 0.2s;
  }

  #convert:hover:not(:disabled) {
    background: #333;
  }

  #convert:disabled {
    background: #d2d2d2;
    cursor: not-allowed;
  }

  #status {
    margin-top: 16px;
    color: #555;
    font-size: 14px;
  }

  /* Hidden rendering area */
  #renderArea {
    display: none;
    max-width: 800px;
    margin: 18px auto;
    background: #fff;
    padding: 20px;
  }
</style>
</head>

<body>
  <div class="card">
    <h1>Word → PDF Converter</h1>
    <p class="lead">Private, secure, and works fully in your browser. Enhanced support for images and tables.</p>

    <div id="drop">Click or drag a <strong>.docx</strong> file here</div>

    <button id="convert" disabled>Convert to PDF</button>
    <div id="status"></div>

    <div id="renderArea"></div>
  </div>

<script>
  const drop = document.getElementById('drop');
  const convertBtn = document.getElementById('convert');
  const status = document.getElementById('status');
  const renderArea = document.getElementById('renderArea');

  let selectedFile = null;

  // open file picker on click
  drop.addEventListener('click', () => {
    const input = document.createElement('input');
    input.type = 'file';
    input.accept = '.docx';
    input.onchange = e => {
      if (e.target.files && e.target.files[0]) {
        handleFile(e.target.files[0]);
      }
    };
    input.click();
  });

  // Drag events
  drop.addEventListener('dragover', (e) => {
    e.preventDefault();
    drop.classList.add('dragover');
  });

  drop.addEventListener('dragleave', () => {
    drop.classList.remove('dragover');
  });

  drop.addEventListener('drop', (e) => {
    e.preventDefault();
    drop.classList.remove('dragover');

    const f = e.dataTransfer.files[0];
    if (f) handleFile(f);
  });

  function handleFile(file) {
    selectedFile = file;
    drop.innerHTML = `<strong>${escapeHtml(file.name)}</strong>`;
    convertBtn.disabled = false;
    status.textContent = '';
  }

  function escapeHtml(s) {
    return s.replace(/[&<>"'`=\/]/g, function(c) {
      return {
        '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;',
        "'": '&#39;', '/': '&#x2F;', '`': '&#x60;', '=': '&#x3D;'
      }[c];
    });
  }

  // Convert button
  convertBtn.addEventListener('click', async () => {
    if (!selectedFile) return;

    convertBtn.disabled = true;
    status.textContent = 'Converting... please wait.';
    renderArea.style.display = 'block';
    renderArea.innerHTML = '';

    try {
      const arrayBuffer = await selectedFile.arrayBuffer();

      // Mammoth converts DOCX → HTML (with image support)
      const mammothOptions = {
        convertImage: mammoth.images.inline(function(element) {
          return element.read("base64").then(function(imageBuffer) {
            return {
              src: "data:" + element.contentType + ";base64," + imageBuffer
            };
          });
        })
      };

      const result = await mammoth.convertToHtml({ arrayBuffer }, mammothOptions);

      const wrapper = document.createElement('div');
      wrapper.style.padding = '18px';
      wrapper.style.fontFamily = 'serif';
      wrapper.innerHTML = result.value;

      wrapper.querySelectorAll('img').forEach(img => {
        img.style.maxWidth = '100%';
        img.style.height = 'auto';
      });

      wrapper.querySelectorAll('table').forEach(tbl => {
        tbl.style.width = '100%';
        tbl.style.borderCollapse = 'collapse';
      });

      wrapper.querySelectorAll('td, th').forEach(cell => {
        cell.style.border = '1px solid #ddd';
        cell.style.padding = '6px';
      });

      const title = document.createElement('div');
      title.style.textAlign = 'center';
      title.style.marginBottom = '12px';
      title.innerHTML = `<strong>${escapeHtml(selectedFile.name)}</strong>`;

      renderArea.appendChild(title);
      renderArea.appendChild(wrapper);

      const opt = {
        margin: 10,
        filename: selectedFile.name.replace(/\.docx$/i, '.pdf'),
        image: { type: 'jpeg', quality: 0.96 },
        html2canvas: { scale: 2, useCORS: true },
        jsPDF: { unit: 'pt', format: 'a4', orientation: 'portrait' }
      };

      await new Promise(r => setTimeout(r, 200));
      await html2pdf().set(opt).from(renderArea).save();

      status.textContent = 'Done — PDF downloaded.';
    } catch (err) {
      console.error(err);
      status.textContent = 'Conversion failed.';
      alert('Error: see browser console for details.');
    } finally {
      convertBtn.disabled = false;
      renderArea.style.display = 'none';
    }
  });
</script>

</body>
</html>
